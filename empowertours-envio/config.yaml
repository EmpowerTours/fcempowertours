# yaml-language-server: $schema=./node_modules/envio/evm.schema.json
name: empowertours-envio
description: EmpowerTours NFT Indexer for Monad Mainnet - Music, Passports & Itineraries
networks:
  - id: 143  # Monad Mainnet
    start_block: 1  # Start from beginning of mainnet
    hypersync_config:
      url: https://monad.hypersync.xyz
    contracts:
      - name: EmpowerToursNFT
        address:
          - "0xB9B3acf33439360B55d12429301E946f34f3B73F"  # Mainnet EmpowerToursNFT
        handler: src/EventHandlers.ts
        events:
          # Master NFT minting (with artistFid and royalty)
          - event: "MasterMinted(uint256 indexed tokenId, address indexed artist, uint256 indexed artistFid, string tokenURI, uint256 price, uint8 nftType, uint96 royalty)"
            field_selection:
              transaction_fields:
                - hash

          # Collector Master minting
          - event: "CollectorMasterMinted(uint256 indexed tokenId, address indexed artist, uint256 indexed artistFid, uint256 maxEditions, uint256 collectorPrice)"
            field_selection:
              transaction_fields:
                - hash

          # License purchase (with expiry timestamp)
          - event: "LicensePurchased(uint256 indexed licenseId, uint256 indexed masterTokenId, uint256 indexed licenseeFid, address buyer, uint256 expiry, bool isCollector)"
            field_selection:
              transaction_fields:
                - hash

          # License resale (10% treasury, 60% artist, 30% seller)
          - event: "LicenseSold(uint256 indexed licenseId, uint256 indexed masterTokenId, address indexed seller, address buyer, uint256 salePrice, uint256 royaltyPaid, address royaltyRecipient)"
            field_selection:
              transaction_fields:
                - hash

          # Royalty tracking
          - event: "RoyaltyPaid(uint256 indexed masterTokenId, address indexed artist, uint256 amount)"
            field_selection:
              transaction_fields:
                - hash

          # Price updates
          - event: "PriceUpdated(uint256 indexed masterTokenId, uint256 newPrice)"
            field_selection:
              transaction_fields:
                - hash

          # NFT transfer tracking
          - event: "Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"
            field_selection:
              transaction_fields:
                - hash

          # NFT burning events
          - event: "NFTBurned(uint256 indexed tokenId, address indexed burner, uint256 rewardReceived, uint256 timestamp, string burnType)"
            field_selection:
              transaction_fields:
                - hash

          - event: "BurnRewardUpdated(string rewardType, uint256 newReward, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          # Stolen content removal (admin)
          - event: "StolenContentBurned(uint256 indexed tokenId, address indexed originalOwner, string reason, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          # Artist song cleared (allows reminting after burn)
          - event: "ArtistSongCleared(address indexed artist, string title, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

      - name: PassportNFTV2
        address:
          - "0x93126e59004692B01961BE505aa04F55d5bd1851"  # Mainnet PassportNFTV3
        handler: src/EventHandlers.ts
        events:
          # Passport minting with country data, region, continent, and FID
          - event: "PassportMinted(uint256 indexed tokenId, address indexed owner, uint256 indexed userFid, string countryCode, string countryName, string region, string continent, bool verified)"
            field_selection:
              transaction_fields:
                - hash

          # NFT transfer tracking
          - event: "Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"
            field_selection:
              transaction_fields:
                - hash

          # Verification flow (V2: renamed events)
          - event: "VerificationProofSubmitted(uint256 indexed tokenId, address indexed submitter, string proofIPFSHash, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          - event: "PassportVerified(uint256 indexed tokenId, address indexed verifier, string verificationProof, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          # Venue stamps (V2: location, placeId, verified, timestamp)
          - event: "VenueStampAdded(uint256 indexed tokenId, string location, string placeId, bool verified, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          # Itinerary stamps (V2: locationName, city, country, placeId, gpsVerified, timestamp)
          - event: "ItineraryStampAdded(uint256 indexed tokenId, uint256 indexed itineraryId, string locationName, string city, string country, string placeId, bool gpsVerified, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

      - name: ItineraryNFTV2
        address:
          - "0x97529316356A5bcAd81D85E9a0eF941958c4b020"  # Mainnet ItineraryNFTV2
        handler: src/EventHandlers.ts
        events:
          # Itinerary creation (V2: removed city/country, added photoProof)
          - event: "ItineraryCreated(uint256 indexed itineraryId, address indexed creator, uint256 indexed creatorFid, string title, uint256 price, string photoProof)"
            field_selection:
              transaction_fields:
                - hash

          # Itinerary purchase (V2: added creatorEarnings)
          - event: "ItineraryPurchased(uint256 indexed itineraryId, address indexed buyer, uint256 indexed buyerFid, uint256 price, uint256 creatorEarnings)"
            field_selection:
              transaction_fields:
                - hash

          # Location completion (V2: placeId instead of photoProofIPFS name)
          - event: "LocationCompleted(uint256 indexed itineraryId, address indexed user, uint256 locationIndex, string placeId, string photoProof)"
            field_selection:
              transaction_fields:
                - hash

          # Itinerary completed (V2: NEW - all locations done)
          - event: "ItineraryCompleted(uint256 indexed itineraryId, address indexed user)"
            field_selection:
              transaction_fields:
                - hash

          # Rating (V2: removed reviewIPFS)
          - event: "ItineraryRated(uint256 indexed itineraryId, address indexed user, uint256 rating)"
            field_selection:
              transaction_fields:
                - hash

          # Location added (V2: NEW - when locations are added to itinerary)
          - event: "LocationAdded(uint256 indexed itineraryId, uint256 locationIndex, string placeId)"
            field_selection:
              transaction_fields:
                - hash

          # NFT transfer
          - event: "Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"
            field_selection:
              transaction_fields:
                - hash

      # MusicSubscription Contract - 10/20/70 Distribution Model
      - name: MusicSubscriptionV4
        address:
          - "0xCB11282E5797E036C98D321b276Cb162cde845E5"  # Mainnet MusicSubscriptionV4
        handler: src/EventHandlers.ts
        events:
          # Subscription lifecycle with FID
          - event: "Subscribed(address indexed user, uint256 indexed userFid, uint8 tier, uint256 expiry, uint256 paidAmount)"
            field_selection:
              transaction_fields:
                - hash

          - event: "SubscriptionRenewed(address indexed user, uint256 newExpiry)"
            field_selection:
              transaction_fields:
                - hash

          # Play tracking for artist payouts
          - event: "PlayRecorded(address indexed user, uint256 indexed masterTokenId, uint256 duration, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          # Monthly revenue distribution (10% treasury, 20% reserve, 70% artist pool)
          - event: "MonthlyDistributionFinalized(uint256 indexed monthId, uint256 totalRevenue, uint256 totalPlays, uint256 artistPool)"
            field_selection:
              transaction_fields:
                - hash

          - event: "ArtistPayout(uint256 indexed monthId, address indexed artist, uint256 amount, uint256 playCount)"
            field_selection:
              transaction_fields:
                - hash

          # TOURS rewards for eligible artists
          - event: "ArtistToursReward(uint256 indexed monthId, address indexed artist, uint256 toursAmount)"
            field_selection:
              transaction_fields:
                - hash

          # Reserve tracking
          - event: "ReserveAdded(uint256 indexed monthId, uint256 amount, uint256 totalReserve)"
            field_selection:
              transaction_fields:
                - hash

          - event: "ReserveWithdrawnToDAO(address indexed dao, uint256 amount)"
            field_selection:
              transaction_fields:
                - hash

          # Anti-bot and governance
          - event: "AccountFlagged(address indexed user, string reason)"
            field_selection:
              transaction_fields:
                - hash

          - event: "AccountUnflagged(address indexed user)"
            field_selection:
              transaction_fields:
                - hash

          - event: "VoteToFlag(address indexed voter, address indexed target, uint256 totalVotes)"
            field_selection:
              transaction_fields:
                - hash

      # PlayOracle Contract - Backend oracle for play recording
      - name: PlayOracleV3
        address:
          - "0xe210b31bBDf8B28B28c07D45E9B4FC886aafDCEf"  # Mainnet PlayOracleV3
        handler: src/EventHandlers.ts
        events:
          - event: "PlayRecorded(address indexed user, uint256 indexed masterTokenId, uint256 duration, uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          - event: "OperatorAdded(address indexed operator)"
            field_selection:
              transaction_fields:
                - hash

          - event: "OperatorRemoved(address indexed operator)"
            field_selection:
              transaction_fields:
                - hash

      # LiveRadio Contract - World Cup 2026 Jukebox
      - name: LiveRadioV2
        address:
          - "0x26b32987cb5d7946D81e0Cc7459f26CdeC773101"  # Mainnet LiveRadioV2
        handler: src/EventHandlers.ts
        events:
          # Radio lifecycle
          - event: "RadioStarted(uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          - event: "RadioStopped(uint256 timestamp)"
            field_selection:
              transaction_fields:
                - hash

          # Song queuing
          - event: "SongQueued(uint256 indexed queueId, uint256 indexed masterTokenId, address indexed queuedBy, uint256 fid, uint256 paidAmount, uint256 tipAmount, bool hadLicense)"
            field_selection:
              transaction_fields:
                - hash

          # Song played (tracks all plays - queued and random)
          - event: "SongPlayed(uint256 indexed queueId, uint256 indexed masterTokenId, address indexed artist, uint256 artistPayout, bool wasRandom)"
            field_selection:
              transaction_fields:
                - hash

          # Voice notes
          - event: "VoiceNoteSubmitted(uint256 indexed noteId, address indexed submitter, uint256 duration, uint256 paidAmount, bool isAd)"
            field_selection:
              transaction_fields:
                - hash

          - event: "VoiceNotePlayed(uint256 indexed noteId, address indexed submitter, uint256 rewardPaid)"
            field_selection:
              transaction_fields:
                - hash

          # Listener rewards
          - event: "ListenerRewarded(address indexed listener, uint256 amount, string rewardType)"
            field_selection:
              transaction_fields:
                - hash

          - event: "StreakBonusClaimed(address indexed listener, uint256 streakDays, uint256 bonusAmount)"
            field_selection:
              transaction_fields:
                - hash

          - event: "FirstListenerBonus(address indexed listener, uint256 day, uint256 bonusAmount)"
            field_selection:
              transaction_fields:
                - hash

          # Tips and rewards
          - event: "TipReceived(uint256 indexed masterTokenId, address indexed artist, address indexed tipper, uint256 amount)"
            field_selection:
              transaction_fields:
                - hash

          - event: "RewardsClaimed(address indexed user, uint256 amount)"
            field_selection:
              transaction_fields:
                - hash

          # Random song selection (Pyth Entropy)
          - event: "RandomSongRequested(uint64 indexed sequenceNumber, address indexed requester)"
            field_selection:
              transaction_fields:
                - hash

          - event: "RandomSongSelected(uint256 indexed masterTokenId, bytes32 randomValue)"
            field_selection:
              transaction_fields:
                - hash

          # Song pool management
          - event: "SongAddedToPool(uint256 indexed masterTokenId)"
            field_selection:
              transaction_fields:
                - hash

          - event: "SongRemovedFromPool(uint256 indexed masterTokenId)"
            field_selection:
              transaction_fields:
                - hash

rollback_on_reorg: false
