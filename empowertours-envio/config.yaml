# yaml-language-server: $schema=./node_modules/envio/evm.schema.json
name: empowertours-envio
description: EmpowerTours NFT Indexer for Monad - Music, Passports & Itineraries
networks:
  - id: 10143
    start_block: 41800000  # ✅ UPDATED: Block where MusicLicenseNFTv4 was deployed
    contracts:
      - name: MusicLicenseNFT
        address:
          - "0x5adb6c3Dc258f2730c488Ea81883dc222A7426B6"  # ✅ UPDATED: v4 address
        handler: src/EventHandlers.ts
        events:
          # Master NFT minting
          - event: "MasterMinted(uint256 indexed tokenId, address indexed artist, string tokenURI, uint256 price)"
            field_selection:
              transaction_fields:
                - hash
          
          # ✅ License purchase with expiry tracking
          - event: "LicensePurchased(uint256 indexed licenseId, uint256 indexed masterTokenId, address indexed buyer, uint256 expiry)"
            field_selection:
              transaction_fields:
                - hash
          
          # ✅ License expiration tracking
          - event: "LicenseExpired(uint256 indexed licenseId)"
            field_selection:
              transaction_fields:
                - hash
          
          # Royalty tracking
          - event: "RoyaltyPaid(uint256 indexed tokenId, address indexed recipient, uint256 amount)"
            field_selection:
              transaction_fields:
                - hash
          
          # Price updates
          - event: "PriceUpdated(uint256 indexed masterTokenId, uint256 newPrice)"
            field_selection:
              transaction_fields:
                - hash
          
          # NFT transfer tracking
          - event: "Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"
            field_selection:
              transaction_fields:
                - hash
      
      - name: PassportNFT
        address:
          - "0x5B5aB516fcBC1fF0ac26E3BaD0B72f52E0600b08"
        handler: src/EventHandlers.ts
        events:
          # Passport minting with country data
          - event: "PassportMinted(uint256 indexed tokenId, address indexed owner, string countryCode, string countryName, string region, string continent)"
            field_selection:
              transaction_fields:
                - hash
          
          # NFT transfer tracking
          - event: "Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"
            field_selection:
              transaction_fields:
                - hash
      
      - name: Marketplace
        address:
          - "0x48a4B5b9F97682a4723eBFd0086C47C70B96478C"
        handler: src/EventHandlers.ts
        events:
          # Itinerary creation
          - event: "ItineraryCreated(uint256 indexed itineraryId, address indexed creator, string description, uint256 price)"
            field_selection:
              transaction_fields:
                - hash
          
          # Itinerary purchase
          - event: "ItineraryPurchased(uint256 indexed itineraryId, address indexed buyer)"
            field_selection:
              transaction_fields:
                - hash

rollback_on_reorg: false
